## Описание
Для общения с PostgreSQL используется стандартный пакет `database/sql` с драйвером
`github.com/lib/pq`.

Аутентификация базовая (Basic Auth). Пароли хранятся в базе данных в зашифрованном 
виде (1 итерация, SHA-256), без соли.

В Яндекс.Спеллер запросы отправляются методом POST. По документации серсива, 
максимальный размер текста в это случае составляет 10_000 символов. API будет 
возвращаться ошибку `413 Payload Too Large`, если текст превышает это ограничение.


## Конфигурация

Для запуска необходимо создать `.env` файл со следующими необходимыми переменными:

```
POSTGRES_HOST=postgres
POSTGRES_PASSWORD=mypassword
YANDEX_SPELLER_URL=https://speller.yandex.net/services/spellservice.json/checkText

TARGET_STAGE=run

SERVER_ADDRESS=:8080
YANDEX_SPELLER_TIMEOUT=10
```

### Обязательно

- `POSTGRES_HOST`: адрес запущенного PostreSQL БЕЗ ПОРТА. При запуске с `docker compose`
  необходимо указать название сервиса с PostgreSQL (из `compose.yaml` файла).

- `POSTGRES_PASSWORD`: пароль пользователя для соединения с PostgreSQL. 

- `YANDEX_SPELLER_URL`: URL API Яндекс.Спеллер, который принимает POST запросы. 
  На момент создания программы корректный URL - `https://speller.yandex.net/services/spellservice.json/checkText`

- `TARGET_STAGE`: `[ run | test ]` целевой этап сборки `Dockerfile`а. Используется в 
`compose.yaml`. `run` полноценно запустит веб-сервер. `test` запустит тесты.
Данная переменная нужна только для сборки с `docker compose`. При желании его
можно убрать из `.env` файла, и пользоваться утилитой `make` + `Makefile`, где
данная переменная уже задана.


### Необязательно

- `SERVER_ADDRESS`: адрес, который будет слушать веб-сервер. Лучше указать
только порт в формате `:8080`. Так сервер будет слушать локальную
сеть (0.0.0.0) с указанным портом.

- `YANDEX_SPELLER_TIMEOUT`: время в секундах, после которого запрос на сервер Яндекс.Спеллер
  отменяется.

## Трудности
При интеграции с Яндекс.Спеллер возникла проблема: в документации нигде не указано 
в каком именно формате должно быть тело запроса при использовании через POST запрос. 
Альтернативный вариант с GET запросом требует отправки текста в виде path-параметра, 
а это имеет серьезный недостаток — максимальный размер URL — 2083 символов для 
Google Chrome, что довольно мало для приложения заметок.

В итоге, с помощью Chrome DevTools и получилось узнать, что тело запроса отправляется 
в виде `form-data`.

Были также трудности с системой аутентификации. Сначала было задумно сделать более сложную 
версию с созданием временных сессий, куками и прочим удовольствием, но понял, что:

- это займет много времени,
- я не смог заставить работать автоудаление устаревших сессий. Была проблема с "прокидыванием"
  необходимых значений времени в SQL формулу ([ссылка](https://github.com/tymbaca/kodenotes/blob/835253728ded9a932784f90cab7c3edf5d20cbfa/database/postgres.go#L137C1-L151C2)).


## Какой-то чеклист

- [ ] Интеграция с PostgreSQL
- [ ] Интеграя с Яндекс.Спеллер
- [ ] Регистрация


